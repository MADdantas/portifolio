name: Merge any release or staging branch to develop
permissions:
  contents: write
  pull-requests: write
on:
  push:
    branches:
      - staging
      - 'release/*'
env:
  NEW_BRANCH: ${{ 'merge/' }}${{ github.ref_name }}
  GITHUB_TOKEN: ${{ secrets.AUTOMATION_ACCESS_TOKEN }}
  MERGE_LABELS: "automerge"
  MERGE_REMOVE_LABELS: "merge-failed"
jobs:
  merge-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Creating new branch
        uses: peterjgrainger/action-create-branch@v2.2.0
        with:
          branch: 'refs/heads/${{ env.NEW_BRANCH }}'

      - uses: actions/checkout@master

      - name: Create Pull Request
        uses: repo-sync/pull-request@master
        with:
          destination_branch: '${{ env.NEW_BRANCH }}'
          source_branch: 'main'
          pr_title: "[Automation] develop into ${{ env.NEW_BRANCH }}" # Title of pull request
          pr_body: 'Pr created by automation to run tests'
          pr_assignee: ${{github.actor}}                         # Comma-separated list (no spaces)
          pr_label: "merge-failed,automerge"             # Comma-separated list (no spaces)
          pr_draft: false                                    # Creates pull request as draft
          
      - id: automerge
        name: automerge
        uses: "pascalgn/automerge-action@v0.15.6"